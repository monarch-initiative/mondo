sudo: required

services:
  - docker

before_install:
  - env | sort
  # The following triggers the Jenkis build. Shahim is managing this.
  - >
    curl -X 
    POST "https://monarch-jenkins.cgrb.oregonstate.edu/job/test-mondo/build" 
    -H "Jenkins-Crumb:${ShahimCSRFCrumb}" 
    --user "essaids:${ShahimAPIToken}" 
    --form json='{
    "parameter": [
       {"name":"TRAVIS_BRANCH", "value":"'"${TRAVIS_BRANCH}"'"},
       {"name":"TRAVIS_COMMIT", "value":"'"${TRAVIS_COMMIT}"'"},
       {"name":"TRAVIS_COMMIT_MESSAGE", "value":"'"${TRAVIS_COMMIT_MESSAGE}"'"},
       {"name":"TRAVIS_PULL_REQUEST_BRANCH", "value":"'"${TRAVIS_PULL_REQUEST_BRANCH}"'"},
       {"name":"TRAVIS_PULL_REQUEST", "value":"'"${TRAVIS_PULL_REQUEST_SHA}"'"},
       {"name":"TRAVIS_EVENT_TYPE", "value":"'"${TRAVIS_EVENT_TYPE}"'"},
       {"name":"TRAVIS_BUILD_WEB_URL", "value":"'"${TRAVIS_BUILD_WEB_URL}"'"},
       {"name":"TRAVIS_BUILD_NUMBER", "value":"'"${TRAVIS_BUILD_NUMBER}"'"}
     ]}'
  - docker pull obolibrary/odkfull

before_script:
  - cd src/ontology

script:
  - ./run.sh make test

# whitelist
branches:
  only:
    - master
    - test-travis

### UNCOMMENT THIS AND ADD YOUR DETAILS:
#notifications:
#  email:
#    - YOURNAME@YOU.ORG
